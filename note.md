# 202010403-Node的基本概念



## node是什么

1. 基于chrome v8的运行环境
2. 事件驱动
3. 非阻塞I/O模型

## node解决了那些问题

> web的主要场景就是接收客户端的请求读取静态资源和渲染界面，node非常合适

1. 高并发
   1. 同一时间并发访问服务器
2. I/O密集型（相对于CPU密集型， 指的是逻辑处理，运算，压缩，加密，解密）
   1. 文件操作
   2. 网络操作
   3. 数据库

## js单线程

js当初在设计的时候就被设计成了单线程，主要目的是为了防止多线程操作DOM时会发生混乱的问题
这里的单线程指的是主线程是单线程的，同样在node中主线程也是单线程的

1. 单线程的特点是节约内存，不需要再切换执行上下文
2. 单线程不用处理锁的问题

## 同步异步和阻塞非阻塞

> 同步和异步关注的是消息通信机制 (synchronous communication/ asynchronous communication)

### 同步

所谓同步，就是在发出一个**调用**时，在没有得到结果之前，该**调用**就不返回。但是一旦调用返回，就得到返回值了。

调用者主动等待这个调用结果

### 异步

一个异步过程调用发出后，调用者不会立刻得到结果。而是在**调用**发出后，**被调用者**通过状态、通知来通知调用者，或通过回调函数处理这个调用

> 阻塞和非阻塞关注的是程序在等待调用结果（消息，返回值）时的状态.

### 同步阻塞

“同步”是发起了一个调用后， 没有得到结果之前不返回， 那它毫无疑问就是被“阻塞”了（即调用进程处于 “waiting” 状态）。

### 异步阻塞

发起调用后，继续等待， 调用者同步
被调用者异步， 被调用者调用成功返回调用者

### 同步非阻塞
调用者发起， 不等待， 调用者同步
过一段时间后， 查询是否调用成功

### 异步非阻塞

调用者发起，不等待，调用者异步
被调用者调用成功后，通知调用者


### node中的eventloop

1. js代码交给v8引擎处理
2. nodeApi会交给libuv处理
3. libuv通过I/O和多线程实现异步IO
4. 通过事件驱动的方式，将结果放到事件队列中，最终交给应用

```js
// --------------------------------------
// 1. timers, 优先处理setTimeout和setInterval
// 2. pending callbacks， 延迟到下一个循环的I/O
// 3. idle，prepare 系统内部调用
// 4. poll，新的事件， 处理I/O相关的回调
// 5. setImmediate
// 6. close callbacks， 一些关闭的回调函数
```

`process.nextTick`会放到执行栈的最后面， 不属于执行栈的一部分

## node中的全局对象

1. `Buffer`
2. `process`
3. `setInterval`, `setTimeout`, `setImmediate`
4. `console`
5. `queueMicrotask`

## node中的模块

1. `__dirname`
2. `__filename`
3. `exports`
4. `module`
5. `require`